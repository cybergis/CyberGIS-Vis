{"version":3,"file":"leaflet-lasso.esm.js","sources":["../src/lasso-polygon.ts","../src/calc.ts","../node_modules/style-inject/dist/style-inject.es.js","../src/lasso-handler.ts","../src/lasso-control.ts","../src/index.ts"],"sourcesContent":["import L from 'leaflet';\n\nexport class LassoPolygon extends L.Layer {\n    readonly polyline: L.Polyline;\n    readonly polygon: L.Polygon;\n\n    constructor(latlngs: L.LatLngExpression[], options?: L.PolylineOptions) {\n        super();\n\n        this.polyline = L.polyline(latlngs, options);\n        this.polygon = L.polygon(latlngs, { ...options, weight: 0 });\n    }\n\n    onAdd(map: L.Map): this {\n        this.polyline.addTo(map);\n        this.polygon.addTo(map);\n\n        return this;\n    }\n\n    onRemove(): this {\n        this.polyline.remove();\n        this.polygon.remove();\n\n        return this;\n    }\n\n    addLatLng(latlng: L.LatLngExpression): this {\n        this.polyline.addLatLng(latlng);\n        this.polygon.addLatLng(latlng);\n\n        return this;\n    }\n\n    getLatLngs(): L.LatLng[] {\n        return this.polygon.getLatLngs()[0] as L.LatLng[];\n    }\n\n    toGeoJSON(): GeoJSON.Feature<GeoJSON.Polygon> {\n        return this.polygon.toGeoJSON() as GeoJSON.Feature<GeoJSON.Polygon>;\n    }\n}","import L from 'leaflet';\nimport Terraformer from 'terraformer';\nimport circleToPolygon from 'circle-to-polygon';\n\nfunction getCircleMarkerRadius(circleMarker: L.CircleMarker, crs: L.CRS, zoom: number) {\n    const latLng = circleMarker.getLatLng();\n    const point = crs.latLngToPoint(latLng, zoom);\n    const delta = circleMarker.getRadius() / Math.SQRT2;\n    const topLeftPoint = L.point([point.x - delta, point.y - delta]);\n    const topLeftLatLng = crs.pointToLatLng(topLeftPoint, zoom);\n    const radius = crs.distance(latLng, topLeftLatLng);\n    return radius;\n}\n\nfunction circleToGeoJSONGeometry(latLng: L.LatLng, radius: number) {\n    // Terraformer result is incorrect, see https://github.com/Esri/terraformer/issues/321\n    // return new Terraformer.Circle(L.GeoJSON.latLngToCoords(latLng), radius).geometry;\n\n    return circleToPolygon(L.GeoJSON.latLngToCoords(latLng), radius);\n}\n\nexport function getLayersInPolygon(polygon: GeoJSON.Polygon, layers: L.Layer[], options: { zoom?: number, crs?: L.CRS, intersect?: boolean } = {}) {\n    const crs = options.crs || L.CRS.EPSG3857;\n    const polygonGeometry = new Terraformer.Primitive(polygon);\n\n    const selectedLayers = layers.filter(layer => {\n        let layerGeometry: GeoJSON.GeometryObject;\n\n        if (layer instanceof L.Circle) {\n            const latLng = layer.getLatLng();\n            const radius = layer.getRadius();\n            layerGeometry = circleToGeoJSONGeometry(latLng, radius);\n        } else if (layer instanceof L.CircleMarker) {\n            if (options.zoom != undefined) {\n                const latLng = layer.getLatLng();\n                const radius = getCircleMarkerRadius(layer, crs, options.zoom);\n                layerGeometry = circleToGeoJSONGeometry(latLng, radius);\n            } else {\n                console.warn(\"Zoom is required for calculating CircleMarker polygon, falling back to center point only\");\n                layerGeometry = layer.toGeoJSON().geometry;\n            }\n        } else if (layer instanceof L.Marker || layer instanceof L.Polyline) {\n            layerGeometry = layer.toGeoJSON().geometry;\n        } else {\n            return false;\n        }\n\n        return options.intersect && layerGeometry.type !== \"Point\" ?\n            polygonGeometry.intersects(layerGeometry) :\n            polygonGeometry.contains(layerGeometry);\n    });\n    \n    return selectedLayers;\n}","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import L from 'leaflet';\nimport { LassoPolygon } from './lasso-polygon';\nimport { getLayersInPolygon } from './calc';\nimport './lasso-handler.css';\n\nexport interface LassoHandlerOptions {\n    polygon?: L.PolylineOptions,\n    intersect?: boolean;\n}\n\ninterface LassoHandlerFinishedEventData {\n    latLngs: L.LatLng[];\n    layers: L.Layer[];\n}\n\nexport type LassoHandlerFinishedEvent = L.LeafletEvent & LassoHandlerFinishedEventData;\n\nexport const ENABLED_EVENT = 'lasso.enabled';\nexport const DISABLED_EVENT = 'lasso.disabled';\nexport const FINISHED_EVENT = 'lasso.finished';\n\nexport const ACTIVE_CLASS = 'leaflet-lasso-active';\n\nexport class LassoHandler extends L.Handler {\n    options: LassoHandlerOptions = {\n        polygon: {\n            color: '#00C3FF',\n            weight: 2,\n        },\n        intersect: false,\n    };\n\n    private map: L.Map;\n\n    private polygon?: LassoPolygon;\n\n    private onDocumentMouseMoveBound = this.onDocumentMouseMove.bind(this);\n    private onDocumentMouseUpBound = this.onDocumentMouseUp.bind(this);\n\n    constructor(map: L.Map, options: LassoHandlerOptions = {}) {\n        super(map);\n        \n        this.map = map;\n        L.Util.setOptions(this, options);\n    }\n\n    setOptions(options: LassoHandlerOptions) {\n        this.options = { ...this.options, ...options };\n    }\n\n    toggle() {\n        if (this.enabled()) {\n            this.disable();\n        } else {\n            this.enable();\n        }\n    }\n    \n    addHooks() {\n        this.map.getPane('mapPane');\n        this.map.on('mousedown', this.onMapMouseDown, this);\n        \n        const mapContainer = this.map.getContainer();\n        mapContainer.classList.add(ACTIVE_CLASS);\n\n        this.map.dragging.disable();\n        this.map.fire(ENABLED_EVENT);\n    }\n\n    removeHooks() {\n        if (this.polygon) {\n            this.map.removeLayer(this.polygon);\n            this.polygon = undefined;\n        }\n\n        this.map.off('mousedown', this.onMapMouseDown, this);\n        document.removeEventListener('mousemove', this.onDocumentMouseMoveBound);\n        document.removeEventListener('mouseup', this.onDocumentMouseUpBound);\n\n        this.map.getContainer().classList.remove(ACTIVE_CLASS);\n        document.body.classList.remove(ACTIVE_CLASS);\n\n        this.map.dragging.enable();\n        this.map.fire(DISABLED_EVENT);\n    }\n\n    getPolygon() {\n        return this.polygon;\n    }\n\n    private onMapMouseDown(event: L.LeafletEvent) {\n        const event2 = event as L.LeafletMouseEvent;\n\n        // activate lasso only for left mouse button click\n        if (event2.originalEvent.buttons !== 1) {\n            this.disable();\n            return;\n        }\n\n        // skip clicks on controls\n        if ((event2.originalEvent.target as HTMLElement).closest('.leaflet-control-container')) {\n            return;\n        }\n\n        this.polygon = new LassoPolygon([event2.latlng], this.options.polygon).addTo(this.map);\n\n        document.body.classList.add(ACTIVE_CLASS);\n\n        document.addEventListener('mousemove', this.onDocumentMouseMoveBound);\n        document.addEventListener('mouseup', this.onDocumentMouseUpBound);\n    }\n\n    private onDocumentMouseMove(event: Event) {\n        if (!this.polygon) {\n            return;\n        }\n\n        const event2 = event as MouseEvent;\n\n        // keep lasso active only if left mouse button is hold\n        if (event2.buttons !== 1) {\n            console.warn('mouseup event was missed');\n            this.finish();\n            return;\n        }\n\n        this.polygon.addLatLng(this.map.mouseEventToLatLng(event2));\n    }\n\n    private onDocumentMouseUp() {\n        this.finish();\n    }\n\n    private finish() {\n        if (!this.polygon) {\n            return;\n        }\n\n        const polygon = this.polygon.toGeoJSON().geometry;\n        const layers: L.Layer[] = [];\n        this.map.eachLayer(layer => {\n            if (layer === this.polygon || layer === this.polygon!.polyline || layer === this.polygon!.polygon) {\n                return;\n            }\n\n            if (layer instanceof L.Marker || layer instanceof L.Path) {\n                layers.push(layer);\n            } else if (L.MarkerCluster && layer instanceof L.MarkerCluster) {\n                layers.push(...layer.getAllChildMarkers());\n            }\n        });\n\n        const selectedFeatures = getLayersInPolygon(polygon, layers, {\n            zoom: this.map.getZoom(),\n            crs: this.map.options.crs,\n            intersect: this.options.intersect,\n        });\n\n        this.map.fire(FINISHED_EVENT, {\n            latLngs: this.polygon.getLatLngs(),\n            layers: selectedFeatures,\n        } as LassoHandlerFinishedEventData);\n\n        this.disable();\n    }\n}\n","import L from 'leaflet';\nimport { LassoHandler, LassoHandlerOptions } from './lasso-handler';\nimport './lasso-control.css';\n\nexport type LassoControlOptions = LassoHandlerOptions & L.ControlOptions;\n\nexport class LassoControl extends L.Control {\n    options: LassoControlOptions = {\n        position: 'topright',\n    };\n\n    private lasso?: LassoHandler;\n\n    constructor(options: LassoControlOptions = {}) {\n        super();\n\n        L.Util.setOptions(this, options);\n    }\n\n    setOptions(options: LassoControlOptions) {\n        this.options = { ...this.options, ...options };\n        \n        if (this.lasso) {\n            this.lasso.setOptions(this.options);\n        }\n    }\n\n    onAdd(map: L.Map) {\n        this.lasso = new LassoHandler(map, this.options);\n\n        const container = L.DomUtil.create('div', 'leaflet-bar leaflet-control') as HTMLDivElement;\n        const button = L.DomUtil.create('a', 'leaflet-control-lasso', container) as HTMLAnchorElement;\n        button.href = '#';\n        button.title = 'Toggle Lasso';\n        button.setAttribute('role', 'button');\n        button.setAttribute('aria-label', button.title);\n\n        L.DomEvent.addListener(button, 'click', this.toggle, this);\n\n        return container;\n    }\n\n    enabled() {\n        if (!this.lasso) {\n            return false;\n        }\n        return this.lasso.enabled();\n    }\n\n    enable() {\n        if (!this.lasso) {\n            return;\n        }\n        this.lasso.enable();\n    }\n\n    disable() {\n        if (!this.lasso) {\n            return;\n        }\n        this.lasso.disable();\n    }\n\n    toggle() {\n        if (!this.lasso) {\n            return;\n        }\n        this.lasso.toggle();\n    }\n}\n","import L from 'leaflet';\nimport { LassoHandler } from './lasso-handler';\nimport { LassoControl } from './lasso-control';\n\ndeclare module 'leaflet' {\n    type Lasso = LassoHandler;\n    let Lasso: typeof LassoHandler;\n\n    let lasso: (...args: ConstructorParameters<typeof LassoHandler>) => LassoHandler;\n    \n    namespace Control {\n        type Lasso = LassoControl;\n        let Lasso: typeof LassoControl;\n    }\n\n    namespace control {\n        let lasso: (...args: ConstructorParameters<typeof LassoControl>) => LassoControl;\n    }\n}\n\nL.Lasso = LassoHandler;\nL.lasso = (...args: ConstructorParameters<typeof LassoHandler>) => new LassoHandler(...args);\n\nL.Control.Lasso = LassoControl;\nL.control.lasso = (...args: ConstructorParameters<typeof LassoControl>) => new LassoControl(...args);\n\nexport * from './lasso-handler';\nexport * from './lasso-control';"],"names":["tslib_1.__extends"],"mappings":"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"}